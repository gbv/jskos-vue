import{h as e,A as s,e as t,l,B as a,C as n,D as u,V as o,v as r,x as c,n as i,o as v,c as m,p as d,E as h,G as p,b as g,H as f,k as y,I as w,F as k,q as b,J as S,w as j}from"./app.a5d7b78a.js";import{_ as R}from"./LoadingIndicator.afa78c4a.js";import"./shared.4aef2e40.js";function I(t,l=!1){const a=e=>{for(const s of t()){const t=(s.elements||[]).reduce(((s,t)=>s||t&&t.contains(e.target)),!1);!l&&t||s.handler({event:e,isInside:t})}};e((()=>{document.addEventListener("click",a)})),s((()=>{document.removeEventListener("click",a)}))}function L(e,s,t){var l;return function(){var a=this,n=arguments,u=function(){l=null,t||e.apply(a,n)},o=t&&!l;clearTimeout(l),l=setTimeout(u,s),o&&e.apply(a,n)}}var E=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",dateToString:function(e){let s=new Date(e);if(s instanceof Date&&!isNaN(s)){if(e.length<10)return e;let t={year:"numeric",month:"short",day:"numeric"};return e.length>10&&(t=Object.assign({hour:"2-digit",minute:"2-digit",second:"2-digit"},t)),s.toLocaleString(void 0,t)}return"?"},addClickHandlers:I,debounce:L});function T(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const x=t({name:"ItemSearch",components:{LoadingIndicator:R},props:{scheme:{type:Object,default:null},registry:{type:Object,default:null},search:{type:Function,default:null}},emits:["select"],setup(e,{emit:s}){const t=l((()=>e.registry||e.scheme&&e.scheme._registry)),r=l((()=>e.search||(async(e,s)=>s.scheme?t.value.suggest({search:e,scheme:s.scheme}):t.value.vocSuggest({search:e})))),c=a(!1),i=a(!1),v=a(null),m=a(""),d=a(-1),h=a([]),p=a(!1),g=a(null),f=a(null),y=a(null),w=L((async s=>{s=s.trim(),h.value=[],c.value=!0;const t=r.value(s,e);let l;v.value=t.cancel;try{l=(await t).slice(1).reduce(((e,s)=>e=s.map(((s,t)=>(e[t]||[]).concat(s)))),[])}catch(a){if("canceled"===a.message)return;console.error(a),l=[]}s===m.value.trim()&&(h.value=l,v.value=null,c.value=!1)}),200);n(m,(e=>{d.value=-1,null!=v.value&&(v.value("There was a newer search query."),v.value=null),""===e?(c.value=!1,i.value=!1):(h.value=["Waiting for you to stop typing..."],c.value=!0,i.value=!0,w(e))})),n((()=>e.scheme),((e,s)=>{S.compare(s,e)||(m.value="",h.value=[],i.value=!1,c.value=!1,d.value=-1)}));const k=()=>{i.value=!1},b=t=>{k(),d.value=-1;const l={uri:h.value[t][2]};e.scheme&&(l.inScheme=[e.scheme],l.type=["http://www.w3.org/2004/02/skos/core#Concept"]),s("select",l),document.activeElement!==document.body&&document.activeElement.blur()},j=()=>{const e=y.value.childNodes[d.value+1];if(e){const s=e.parentElement.parentElement,t=e.getBoundingClientRect(),l=s.getBoundingClientRect();o.scrollTo(e,100,{container:s,easing:"ease-in",offset:t.bottom>l.bottom?-l.height+t.height:0,cancelable:!0,x:!1,y:!0,force:!1})}};return I((()=>[{elements:[g.value],handler:()=>{i.value=!1,d.value=-1}}])),{isLoading:c,isOpen:i,query:m,searchSelected:d,results:h,uniqueID:"abc",openResults:()=>{i.value=""!==m.value},closeResults:k,chooseResult:b,itemSearch:g,searchInput:f,resultList:y,mouseover(e){p.value||(d.value=e)},mousemove(){p.value=!1},onArrowDown(){p.value=!0,d.value>=h.value.length-1?d.value=0:d.value+=1,j()},onArrowUp(){p.value=!0,d.value<=0?d.value=h.value.length-1:d.value-=1,j()},onEnter(){let e;c.value||0===h.value.length||(e=d.value<0||d.value>=h.value.length?0:d.value,b(e))},highlightQueryInResult:e=>{if(!m.value.length)return e;const s=m.value,t=new RegExp(s,"ig");let l=t.exec(e),a=0,n="";for(;l;){let u=l.index;n+=T(e.slice(a,u))+"<span class='jskos-vue-text-bold'>"+T(e.slice(u,u+s.length))+"</span>",a=u+s.length,l=t.exec(e)}return n+=T(e.slice(a)),n},focus(){f.value.focus()},setQuery(e,s=!1){m.value=e,s?f.value.focus():u((()=>{k()}))}}}}),_=j();r("data-v-6a133b39");const A={class:"jskos-vue-itemSearch-results jskos-vue-text-small"},C={key:0,class:"jskos-vue-itemSearch-loading"},D={ref:"resultList",class:"jskos-vue-itemSearch-results-list"},O={key:0,class:"jskos-vue-itemSearch-results-item"},q=g("div",null,"No results",-1);c();const M=_(((e,s,t,l,a,n)=>{const u=i("loading-indicator");return v(),m("div",{ref:"itemSearch",class:"jskos-vue-itemSearch",onMousemove:s[8]||(s[8]=(...s)=>e.mousemove&&e.mousemove(...s))},[d(" Input field "),h(g("input",{ref:"searchInput","onUpdate:modelValue":s[1]||(s[1]=s=>e.query=s),placeholder:"Type to search...",onClick:s[2]||(s[2]=(...s)=>e.openResults&&e.openResults(...s)),onKeydown:[s[3]||(s[3]=f(y(((...s)=>e.onArrowDown&&e.onArrowDown(...s)),["prevent"]),["down"])),s[4]||(s[4]=f(y(((...s)=>e.onArrowUp&&e.onArrowUp(...s)),["prevent"]),["up"]))],onKeyup:[s[5]||(s[5]=f(((...s)=>e.onEnter&&e.onEnter(...s)),["enter"])),s[6]||(s[6]=f((s=>{e.$refs.searchInput.blur(),e.closeResults()}),["esc"]))],onFocus:s[7]||(s[7]=(...s)=>e.openResults&&e.openResults(...s))},null,544),[[p,e.query]]),d(" Results "),h(g("div",A,[d(" Loading indicator if necessary "),e.isLoading?(v(),m("div",C,[g(u,{size:"md"})])):(v(),m(k,{key:1},[d(" If not loading, show results "),g("ul",D,[(v(!0),m(k,null,b(e.results,((s,t)=>(v(),m("li",{key:t,class:[{"jskos-vue-itemSearch-selected":t===e.searchSelected},"jskos-vue-itemSearch-results-item"],onClick:s=>e.chooseResult(t),onMouseover:s=>e.mouseover(t)},[g("span",{innerHTML:e.highlightQueryInResult(s[0])},null,8,["innerHTML"])],42,["onClick","onMouseover"])))),128)),0==e.results.length?(v(),m("li",O,[d(" TODO: Add other languages "),q])):d("v-if",!0)],512)],2112))],512),[[w,e.isOpen]])],544)}));x.render=M,x.__scopeId="data-v-6a133b39";export{x as _,E as u};
