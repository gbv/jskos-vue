import{l as e,z as s,G as l,H as t,V as u,q as a,o as n,c as o,s as r,D as c,I as i,d as v,J as g,k as m,E as p,b as d,F as h,v as f,n as y}from"./app.d57fb543.js";import{_ as k}from"./LoadingIndicator.52cd3ce7.js";import{a as w,b as R}from"./utils.0f4dc86e.js";import"./shared.99084317.js";function j(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const I=e({name:"ItemSuggest",components:{LoadingIndicator:k},props:{search:{type:Function,default:null}},emits:["select"],setup(e,{emit:a}){const n=s(!1),o=s(!1),r=s(null),c=s(""),i=s(-1),v=s([]),g=s(!1),m=s(null),p=s(null),d=s(null),h=R((async s=>{s=s.trim(),v.value=[],n.value=!0;const l=e.search(s);let t;r.value=l.cancel;try{t=(await l).slice(1).reduce(((e,s)=>e=s.map(((s,l)=>(e[l]||[]).concat(s)))),[])}catch(u){if("canceled"===u.message)return;console.error(u),t=[]}s===c.value.trim()&&(v.value=t,r.value=null,n.value=!1)}),200);l(c,(e=>{i.value=-1,null!=r.value&&(r.value("There was a newer search query."),r.value=null),""===e?(n.value=!1,o.value=!1):(v.value=["Waiting for you to stop typing..."],n.value=!0,o.value=!0,h(e))}));const f=()=>{o.value=!1},y=e=>{f(),i.value=-1,a("select",{uri:v.value[e][2]}),document.activeElement!==document.body&&document.activeElement.blur()},k=()=>{const e=d.value.childNodes[i.value+1];if(e){const s=e.parentElement.parentElement,l=e.getBoundingClientRect(),t=s.getBoundingClientRect();u.scrollTo(e,100,{container:s,easing:"ease-in",offset:l.bottom>t.bottom?-t.height+l.height:0,cancelable:!0,x:!1,y:!0,force:!1})}};return w((()=>[{elements:[m.value],handler:()=>{o.value=!1,i.value=-1}}])),{isLoading:n,isOpen:o,query:c,searchSelected:i,results:v,uniqueID:"abc",openResults:()=>{o.value=""!==c.value},closeResults:f,chooseResult:y,itemSuggest:m,searchInput:p,resultList:d,mouseover(e){g.value||(i.value=e)},mousemove(){g.value=!1},onArrowDown(){g.value=!0,i.value>=v.value.length-1?i.value=0:i.value+=1,k()},onArrowUp(){g.value=!0,i.value<=0?i.value=v.value.length-1:i.value-=1,k()},onEnter(){let e;n.value||0===v.value.length||(e=i.value<0||i.value>=v.value.length?0:i.value,y(e))},highlightQueryInResult:e=>{if(!c.value.length)return e;const s=c.value,l=new RegExp(s,"ig");let t=l.exec(e),u=0,a="";for(;t;){let n=t.index;a+=j(e.slice(u,n))+"<span class='jskos-vue-text-bold'>"+j(e.slice(n,n+s.length))+"</span>",u=n+s.length,t=l.exec(e)}return a+=j(e.slice(u)),a},focus(){p.value.focus()},setQuery(e,s=!1){c.value=e,s?p.value.focus():t((()=>{f()}))}}}}),S={class:"jskos-vue-itemSuggest-results jskos-vue-text-small"},b={key:0,class:"jskos-vue-itemSuggest-loading"},E={ref:"resultList",class:"jskos-vue-itemSuggest-results-list"},L=["onClick","onMouseover"],x=["innerHTML"],q={key:0,class:"jskos-vue-itemSuggest-results-item"},A=v("div",null,"No results",-1);I.render=function(e,s,l,t,u,k){const w=a("loading-indicator");return n(),o("div",{ref:"itemSuggest",class:"jskos-vue-itemSuggest",onMousemove:s[7]||(s[7]=(...s)=>e.mousemove&&e.mousemove(...s))},[r(" Input field "),c(v("input",{ref:"searchInput","onUpdate:modelValue":s[0]||(s[0]=s=>e.query=s),placeholder:"Type to search...",onClick:s[1]||(s[1]=(...s)=>e.openResults&&e.openResults(...s)),onKeydown:[s[2]||(s[2]=g(m(((...s)=>e.onArrowDown&&e.onArrowDown(...s)),["prevent"]),["down"])),s[3]||(s[3]=g(m(((...s)=>e.onArrowUp&&e.onArrowUp(...s)),["prevent"]),["up"]))],onKeyup:[s[4]||(s[4]=g(((...s)=>e.onEnter&&e.onEnter(...s)),["enter"])),s[5]||(s[5]=g((s=>{e.$refs&&e.$refs.searchInput&&e.$refs.searchInput.blur(),e.closeResults()}),["esc"]))],onFocus:s[6]||(s[6]=(...s)=>e.openResults&&e.openResults(...s))},null,544),[[i,e.query]]),r(" Results "),c(v("div",S,[r(" Loading indicator if necessary "),e.isLoading?(n(),o("div",b,[d(w,{size:"md"})])):(n(),o(h,{key:1},[r(" If not loading, show results "),v("ul",E,[(n(!0),o(h,null,f(e.results,((s,l)=>(n(),o("li",{key:l,class:y([{"jskos-vue-itemSuggest-selected":l===e.searchSelected},"jskos-vue-itemSuggest-results-item"]),onClick:s=>e.chooseResult(l),onMouseover:s=>e.mouseover(l)},[v("span",{innerHTML:e.highlightQueryInResult(s[0])},null,8,x)],42,L)))),128)),0==e.results.length?(n(),o("li",q,[r(" TODO: Add other languages "),A])):r("v-if",!0)],512)],2112))],512),[[p,e.isOpen]])],544)};export{I as _};
