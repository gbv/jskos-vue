import{h as e,j as s,e as t,k as l,g as n,l as a,n as o,V as u,p as r,m as c,q as i,o as v,c as d,s as p,u as h,v as m,b as g,x as f,y,z as k,F as w,A as b,B as j,w as S}from"./app.5ac7d51c.js";import{_ as R}from"./LoadingIndicator.730f5faf.js";import"./shared.690f4af6.js";function I(t,l=!1){const n=e=>{for(const s of t()){const t=(s.elements||[]).reduce(((s,t)=>s||t&&t.contains(e.target)),!1);!l&&t||s.handler({event:e,isInside:t})}};e((()=>{document.addEventListener("click",n)})),s((()=>{document.removeEventListener("click",n)}))}function L(e,s,t){var l;return function(){var n=this,a=arguments,o=function(){l=null,t||e.apply(n,a)},u=t&&!l;clearTimeout(l),l=setTimeout(o,s),u&&e.apply(n,a)}}var E=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",dateToString:function(e){let s=new Date(e);if(s instanceof Date&&!isNaN(s)){if(e.length<10)return e;let t={year:"numeric",month:"short",day:"numeric"};return e.length>10&&(t=Object.assign({hour:"2-digit",minute:"2-digit",second:"2-digit"},t)),s.toLocaleString(void 0,t)}return"?"},addClickHandlers:I,debounce:L});function T(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const x=t({name:"ConceptSearch",components:{LoadingIndicator:R},props:{scheme:{type:Object,required:!0},registry:{type:Object,default:null}},emits:["select"],setup(e,{emit:s}){const t=l((()=>e.registry||e.scheme._registry)),r=n(!1),c=n(!1),i=n(null),v=n(""),d=n(-1),p=n([]),h=n(!1),m=n(null),g=n(null),f=n(null),y=L((async s=>{if(!t.value)return[];s=s.trim(),p.value=[],r.value=!0;const l=t.value.suggest({search:s,scheme:e.scheme});let n;i.value=l.cancel;try{n=(await l).slice(1).reduce(((e,s)=>e=s.map(((s,t)=>(e[t]||[]).concat(s)))),[])}catch(a){if("canceled"===a.message)return;console.error(a),n=[]}s===v.value.trim()&&(p.value=n,i.value=null,r.value=!1)}),200);a(v,(e=>{d.value=-1,null!=i.value&&(i.value("There was a newer search query."),i.value=null),""===e?(r.value=!1,c.value=!1):(p.value=["Waiting for you to stop typing..."],r.value=!0,c.value=!0,y(e))})),a((()=>e.scheme),((e,s)=>{j.compare(s,e)||(v.value="",p.value=[],c.value=!1,r.value=!1,d.value=-1)}));const k=()=>{c.value=!1},w=t=>{k(),d.value=-1,s("select",{uri:p.value[t][2],inScheme:[e.scheme]}),document.activeElement!==document.body&&document.activeElement.blur()},b=()=>{const e=f.value.childNodes[d.value+1];if(e){const s=e.parentElement.parentElement,t=e.getBoundingClientRect(),l=s.getBoundingClientRect();u.scrollTo(e,100,{container:s,easing:"ease-in",offset:t.bottom>l.bottom?-l.height+t.height:0,cancelable:!0,x:!1,y:!0,force:!1})}};return I((()=>[{elements:[m.value],handler:()=>{c.value=!1,d.value=-1}}])),{isLoading:r,isOpen:c,query:v,searchSelected:d,results:p,uniqueID:"abc",openResults:()=>{c.value=""!==v.value},closeResults:k,chooseResult:w,conceptSearch:m,searchInput:g,resultList:f,mouseover(e){h.value||(d.value=e)},mousemove(){h.value=!1},onArrowDown(){h.value=!0,d.value>=p.value.length-1?d.value=0:d.value+=1,b()},onArrowUp(){h.value=!0,d.value<=0?d.value=p.value.length-1:d.value-=1,b()},onEnter(){let e;r.value||0===p.value.length||(e=d.value<0||d.value>=p.value.length?0:d.value,w(e))},highlightQueryInResult:e=>{if(!v.value.length)return e;const s=v.value,t=new RegExp(s,"ig");let l=t.exec(e),n=0,a="";for(;l;){let o=l.index;a+=T(e.slice(n,o))+"<span class='jskos-vue-text-bold'>"+T(e.slice(o,o+s.length))+"</span>",n=o+s.length,l=t.exec(e)}return a+=T(e.slice(n)),a},focus(){g.value.focus()},setQuery(e,s=!1){v.value=e,s?g.value.focus():o((()=>{k()}))}}}}),_=S();r("data-v-3385bd1c");const q={class:"jskos-vue-conceptSearch-results jskos-vue-text-small"},A={key:0,class:"jskos-vue-conceptSearch-loading"},O={ref:"resultList",class:"jskos-vue-conceptSearch-results-list"},C={key:0,class:"jskos-vue-conceptSearch-results-item"},D=g("div",null,"No results",-1);c();const M=_(((e,s,t,l,n,a)=>{const o=i("loading-indicator");return v(),d("div",{ref:"conceptSearch",class:"jskos-vue-conceptSearch",onMousemove:s[8]||(s[8]=(...s)=>e.mousemove&&e.mousemove(...s))},[p(" Input field "),h(g("input",{ref:"searchInput","onUpdate:modelValue":s[1]||(s[1]=s=>e.query=s),placeholder:"Type to search...",onClick:s[2]||(s[2]=(...s)=>e.openResults&&e.openResults(...s)),onKeydown:[s[3]||(s[3]=f(y(((...s)=>e.onArrowDown&&e.onArrowDown(...s)),["prevent"]),["down"])),s[4]||(s[4]=f(y(((...s)=>e.onArrowUp&&e.onArrowUp(...s)),["prevent"]),["up"]))],onKeyup:[s[5]||(s[5]=f(((...s)=>e.onEnter&&e.onEnter(...s)),["enter"])),s[6]||(s[6]=f((s=>{e.$refs.searchInput.blur(),e.closeResults()}),["esc"]))],onFocus:s[7]||(s[7]=(...s)=>e.openResults&&e.openResults(...s))},null,544),[[m,e.query]]),p(" Results "),h(g("div",q,[p(" Loading indicator if necessary "),e.isLoading?(v(),d("div",A,[g(o,{size:"md"})])):(v(),d(w,{key:1},[p(" If not loading, show results "),g("ul",O,[(v(!0),d(w,null,b(e.results,((s,t)=>(v(),d("li",{key:t,class:[{"jskos-vue-conceptSearch-selected":t===e.searchSelected},"jskos-vue-conceptSearch-results-item"],onClick:s=>e.chooseResult(t),onMouseover:s=>e.mouseover(t)},[g("span",{innerHTML:e.highlightQueryInResult(s[0])},null,8,["innerHTML"])],42,["onClick","onMouseover"])))),128)),0==e.results.length?(v(),d("li",C,[p(" TODO: Add other languages "),D])):p("v-if",!0)],512)],2112))],512),[[k,e.isOpen]])],544)}));x.render=M,x.__scopeId="data-v-3385bd1c";export{x as _,E as u};
