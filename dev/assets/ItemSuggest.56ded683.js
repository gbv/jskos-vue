import{h as e,A as s,e as t,l,B as n,C as u,D as a,V as o,v as r,x as c,n as i,o as v,c as g,p as d,E as m,G as p,b as h,H as f,k as y,I as w,F as k,q as S,J as b,w as j}from"./app.8f7ad0eb.js";import{_ as R}from"./LoadingIndicator.6f67fafd.js";import"./shared.ae523b09.js";function I(t,l=!1){const n=e=>{for(const s of t()){const t=(s.elements||[]).reduce(((s,t)=>s||t&&t.contains(e.target)),!1);!l&&t||s.handler({event:e,isInside:t})}};e((()=>{document.addEventListener("click",n)})),s((()=>{document.removeEventListener("click",n)}))}function L(e,s,t){var l;return function(){var n=this,u=arguments,a=function(){l=null,t||e.apply(n,u)},o=t&&!l;clearTimeout(l),l=setTimeout(a,s),o&&e.apply(n,u)}}var E=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",dateToString:function(e){let s=new Date(e);if(s instanceof Date&&!isNaN(s)){if(e.length<10)return e;let t={year:"numeric",month:"short",day:"numeric"};return e.length>10&&(t=Object.assign({hour:"2-digit",minute:"2-digit",second:"2-digit"},t)),s.toLocaleString(void 0,t)}return"?"},addClickHandlers:I,debounce:L});function T(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const x=t({name:"ItemSuggest",components:{LoadingIndicator:R},props:{scheme:{type:Object,default:null},registry:{type:Object,default:null},search:{type:Function,default:null}},emits:["select"],setup(e,{emit:s}){const t=l((()=>e.registry||e.scheme&&e.scheme._registry)),r=l((()=>e.search||(async(e,s)=>s.scheme?t.value.suggest({search:e,scheme:s.scheme}):t.value.vocSuggest({search:e})))),c=n(!1),i=n(!1),v=n(null),g=n(""),d=n(-1),m=n([]),p=n(!1),h=n(null),f=n(null),y=n(null),w=L((async s=>{s=s.trim(),m.value=[],c.value=!0;const t=r.value(s,e);let l;v.value=t.cancel;try{l=(await t).slice(1).reduce(((e,s)=>e=s.map(((s,t)=>(e[t]||[]).concat(s)))),[])}catch(n){if("canceled"===n.message)return;console.error(n),l=[]}s===g.value.trim()&&(m.value=l,v.value=null,c.value=!1)}),200);u(g,(e=>{d.value=-1,null!=v.value&&(v.value("There was a newer search query."),v.value=null),""===e?(c.value=!1,i.value=!1):(m.value=["Waiting for you to stop typing..."],c.value=!0,i.value=!0,w(e))})),u((()=>e.scheme),((e,s)=>{b.compare(s,e)||(g.value="",m.value=[],i.value=!1,c.value=!1,d.value=-1)}));const k=()=>{i.value=!1},S=t=>{k(),d.value=-1;const l={uri:m.value[t][2]};e.scheme&&(l.inScheme=[e.scheme],l.type=["http://www.w3.org/2004/02/skos/core#Concept"]),s("select",l),document.activeElement!==document.body&&document.activeElement.blur()},j=()=>{const e=y.value.childNodes[d.value+1];if(e){const s=e.parentElement.parentElement,t=e.getBoundingClientRect(),l=s.getBoundingClientRect();o.scrollTo(e,100,{container:s,easing:"ease-in",offset:t.bottom>l.bottom?-l.height+t.height:0,cancelable:!0,x:!1,y:!0,force:!1})}};return I((()=>[{elements:[h.value],handler:()=>{i.value=!1,d.value=-1}}])),{isLoading:c,isOpen:i,query:g,searchSelected:d,results:m,uniqueID:"abc",openResults:()=>{i.value=""!==g.value},closeResults:k,chooseResult:S,itemSuggest:h,searchInput:f,resultList:y,mouseover(e){p.value||(d.value=e)},mousemove(){p.value=!1},onArrowDown(){p.value=!0,d.value>=m.value.length-1?d.value=0:d.value+=1,j()},onArrowUp(){p.value=!0,d.value<=0?d.value=m.value.length-1:d.value-=1,j()},onEnter(){let e;c.value||0===m.value.length||(e=d.value<0||d.value>=m.value.length?0:d.value,S(e))},highlightQueryInResult:e=>{if(!g.value.length)return e;const s=g.value,t=new RegExp(s,"ig");let l=t.exec(e),n=0,u="";for(;l;){let a=l.index;u+=T(e.slice(n,a))+"<span class='jskos-vue-text-bold'>"+T(e.slice(a,a+s.length))+"</span>",n=a+s.length,l=t.exec(e)}return u+=T(e.slice(n)),u},focus(){f.value.focus()},setQuery(e,s=!1){g.value=e,s?f.value.focus():a((()=>{k()}))}}}}),_=j();r("data-v-431ff74f");const A={class:"jskos-vue-itemSuggest-results jskos-vue-text-small"},C={key:0,class:"jskos-vue-itemSuggest-loading"},D={ref:"resultList",class:"jskos-vue-itemSuggest-results-list"},O={key:0,class:"jskos-vue-itemSuggest-results-item"},q=h("div",null,"No results",-1);c();const M=_(((e,s,t,l,n,u)=>{const a=i("loading-indicator");return v(),g("div",{ref:"itemSuggest",class:"jskos-vue-itemSuggest",onMousemove:s[8]||(s[8]=(...s)=>e.mousemove&&e.mousemove(...s))},[d(" Input field "),m(h("input",{ref:"searchInput","onUpdate:modelValue":s[1]||(s[1]=s=>e.query=s),placeholder:"Type to search...",onClick:s[2]||(s[2]=(...s)=>e.openResults&&e.openResults(...s)),onKeydown:[s[3]||(s[3]=f(y(((...s)=>e.onArrowDown&&e.onArrowDown(...s)),["prevent"]),["down"])),s[4]||(s[4]=f(y(((...s)=>e.onArrowUp&&e.onArrowUp(...s)),["prevent"]),["up"]))],onKeyup:[s[5]||(s[5]=f(((...s)=>e.onEnter&&e.onEnter(...s)),["enter"])),s[6]||(s[6]=f((s=>{e.$refs.searchInput.blur(),e.closeResults()}),["esc"]))],onFocus:s[7]||(s[7]=(...s)=>e.openResults&&e.openResults(...s))},null,544),[[p,e.query]]),d(" Results "),m(h("div",A,[d(" Loading indicator if necessary "),e.isLoading?(v(),g("div",C,[h(a,{size:"md"})])):(v(),g(k,{key:1},[d(" If not loading, show results "),h("ul",D,[(v(!0),g(k,null,S(e.results,((s,t)=>(v(),g("li",{key:t,class:[{"jskos-vue-itemSuggest-selected":t===e.searchSelected},"jskos-vue-itemSuggest-results-item"],onClick:s=>e.chooseResult(t),onMouseover:s=>e.mouseover(t)},[h("span",{innerHTML:e.highlightQueryInResult(s[0])},null,8,["innerHTML"])],42,["onClick","onMouseover"])))),128)),0==e.results.length?(v(),g("li",O,[d(" TODO: Add other languages "),q])):d("v-if",!0)],512)],2112))],512),[[w,e.isOpen]])],544)}));x.render=M,x.__scopeId="data-v-431ff74f";export{x as _,E as u};
