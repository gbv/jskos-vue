import{f as V,_ as B,s as a,A as D,B as N,o as f,c as h,y as L,C as F,b as R,D as k,z as H,a as U,F as z,l as K,n as O,m as W,q as G,j as T}from"../app.58ffbb48.js";import{L as J}from"./LoadingIndicator.35e914a0.js";import{V as P}from"./vue-scrollto.ec7616c3.js";import{b as Q,c as X}from"./utils.18cb2ff0.js";import"./shared.3f0a6f78.js";function b(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const Y=V({name:"ItemSuggest",components:{LoadingIndicator:J},props:{search:{type:Function,default:null}},emits:["select"],setup(e,{emit:l}){const v=a(!1),c=a(!1),g=a(null),i=a(""),n=a(-1),t=a([]),m="abc",d=a(!1),C=a(null),S=a(null),j=a(null),q=X(async s=>{s=s.trim(),t.value=[],v.value=!0;const u=e.search(s);g.value=u.cancel;let r;try{r=(await u).slice(1).reduce((o,w)=>(o=w.map((y,p)=>(o[p]||[]).concat(y)),o),[])}catch(o){if(o.message==="canceled")return;console.error(o),r=[]}s===i.value.trim()&&(t.value=r,g.value=null,v.value=!1)},200);D(i,s=>{n.value=-1,g.value!=null&&(g.value("There was a newer search query."),g.value=null),s===""?(v.value=!1,c.value=!1):(t.value=["Waiting for you to stop typing..."],v.value=!0,c.value=!0,q(s))});const A=()=>{c.value=i.value!==""},I=()=>{c.value=!1},$=s=>{I(),n.value=-1,l("select",{uri:t.value[s][2]}),document.activeElement!==document.body&&document.activeElement.blur()},M=s=>{if(!i.value.length)return s;const u=i.value,r=new RegExp(u,"ig");let o=r.exec(s),w=0,y="";for(;o;){let p=o.index;y+=b(s.slice(w,p))+"<span class='jskos-vue-text-bold'>"+b(s.slice(p,p+u.length))+"</span>",w=p+u.length,o=r.exec(s)}return y+=b(s.slice(w)),y},E=()=>{const s=j.value.childNodes[n.value+1];if(s){const u=s.parentElement.parentElement,r=s.getBoundingClientRect(),o=u.getBoundingClientRect();P.scrollTo(s,100,{container:u,easing:"ease-in",offset:r.bottom>o.bottom?-o.height+r.height:0,cancelable:!0,x:!1,y:!0,force:!1})}};return Q(()=>[{elements:[C.value],handler:()=>{c.value=!1,n.value=-1}}]),{isLoading:v,isOpen:c,query:i,searchSelected:n,results:t,uniqueID:m,openResults:A,closeResults:I,chooseResult:$,itemSuggest:C,searchInput:S,resultList:j,mouseover(s){d.value||(n.value=s)},mousemove(){d.value=!1},onArrowDown(){d.value=!0,n.value>=t.value.length-1?n.value=0:n.value+=1,E()},onArrowUp(){d.value=!0,n.value<=0?n.value=t.value.length-1:n.value-=1,E()},onEnter(){let s;v.value||t.value.length===0||(n.value<0||n.value>=t.value.length?s=0:s=n.value,$(s))},highlightQueryInResult:M,focus(){S.value.focus()},setQuery(s,u=!1){i.value=s,u?S.value.focus():N(()=>{I()})}}}}),Z={class:"jskos-vue-itemSuggest-results jskos-vue-text-small"},_={key:0,class:"jskos-vue-itemSuggest-loading"},x={key:1,ref:"resultList",class:"jskos-vue-itemSuggest-results-list"},ee=["onClick","onMouseover"],se=["innerHTML"],te={key:0,class:"jskos-vue-itemSuggest-results-item"},le=R("div",null,"No results",-1),ne=[le];function oe(e,l,v,c,g,i){const n=G("loading-indicator");return f(),h("div",{ref:"itemSuggest",class:"jskos-vue-itemSuggest",onMousemove:l[7]||(l[7]=(...t)=>e.mousemove&&e.mousemove(...t))},[L(R("input",{ref:"searchInput","onUpdate:modelValue":l[0]||(l[0]=t=>e.query=t),placeholder:"Type to search...",onClick:l[1]||(l[1]=(...t)=>e.openResults&&e.openResults(...t)),onKeydown:[l[2]||(l[2]=k(T((...t)=>e.onArrowDown&&e.onArrowDown(...t),["prevent"]),["down"])),l[3]||(l[3]=k(T((...t)=>e.onArrowUp&&e.onArrowUp(...t),["prevent"]),["up"]))],onKeyup:[l[4]||(l[4]=k((...t)=>e.onEnter&&e.onEnter(...t),["enter"])),l[5]||(l[5]=k(t=>{e.$refs&&e.$refs.searchInput&&e.$refs.searchInput.blur(),e.closeResults()},["esc"]))],onFocus:l[6]||(l[6]=(...t)=>e.openResults&&e.openResults(...t))},null,544),[[F,e.query]]),L(R("div",Z,[e.isLoading?(f(),h("div",_,[U(n,{size:"md"})])):(f(),h("ul",x,[(f(!0),h(z,null,K(e.results,(t,m)=>(f(),h("li",{key:m,class:O([{"jskos-vue-itemSuggest-selected":m===e.searchSelected},"jskos-vue-itemSuggest-results-item"]),onClick:d=>e.chooseResult(m),onMouseover:d=>e.mouseover(m)},[R("span",{innerHTML:e.highlightQueryInResult(t[0])},null,8,se)],42,ee))),128)),e.results.length==0?(f(),h("li",te,ne)):W("",!0)],512))],512),[[H,e.isOpen]])],544)}var ce=B(Y,[["render",oe]]);export{ce as I};
