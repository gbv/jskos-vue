import{o as y,b as N,w as b,r as v,c as T,F as Z,B as x,Z as z,e as P,K as D,P as q,ag as G,h as J,p as Q}from"./framework.BgyxTWzX.js";import{a as d,s as W}from"./utils.DdtXV_wH.js";import{I as X}from"./ItemList.DiuJyUII.js";import{A as Y}from"./Arrow._IZfqqlg.js";/* empty css               */const _=["onClick"],ne=Object.assign({name:"ConceptTree"},{__name:"ConceptTree",props:{modelValue:{type:Object,default:null},concepts:{type:Array,required:!0},hierarchy:{type:Boolean,default:!0},itemListOptions:{type:Object,default:()=>({})}},emits:["select","open","close","update:modelValue"],setup(p,{expose:C,emit:E}){const l=p,g=E,j=Q(null),m=G({}),I=e=>{let t=[],o=e.concept,r=e.depth+1;if(o&&m[o.uri])for(const i of o.narrower||[]){const n={concept:i,depth:r,isSelected:d(l.modelValue,i)};t.push(n),t=t.concat(I(n))}return t},L=J(()=>{let e=[];for(const t of l.concepts){const o={concept:t,depth:0,isSelected:d(l.modelValue,t)};e.push(o),l.hierarchy&&(e=e.concat(I(o)))}return e}),H=e=>{m[e.uri]=!0,g("open",e)},K=e=>{var r,i,n,f,u;let t=(r=l.modelValue)==null?void 0:r.uri,o=t;for(;t;){const s=(i=L.value.find(k=>d(k.concept,{uri:t})))==null?void 0:i.concept;if(t!==o&&d(s,e))return;t=(u=((n=s==null?void 0:s.ancestors)==null?void 0:n[0])||((f=s==null?void 0:s.broader)==null?void 0:f[0]))==null?void 0:u.uri}delete m[e.uri],g("close",e)},M=e=>{m[e.uri]?K(e):H(e)};function O(...e){var t,o;return(o=(t=j.value)==null?void 0:t.isUriInView)==null?void 0:o.call(t,...e)}function V(...e){var t,o;return(o=(t=j.value)==null?void 0:t.scrollToUri)==null?void 0:o.call(t,...e)}async function R(e,{select:t=!0,onlyIfNotInView:o=!0}={}){var k,S,U,$,A,B,F;const r=typeof e=="string"?e:e==null?void 0:e.uri;if(!r)return!1;const i=(k=L.value.find(a=>d(a.concept,{uri:r})))==null?void 0:k.concept;if(i)return t&&g("update:modelValue",i),await q(),V(r,o),!0;if(!l.hierarchy)return!1;const n=(S=l.concepts)==null?void 0:S[0],f=(n==null?void 0:n._registry)||(($=(U=n==null?void 0:n.inScheme)==null?void 0:U[0])==null?void 0:$._registry);if(!(f!=null&&f.getConcepts))return!1;let u=[{uri:r}];try{const a=async c=>(await f.getConcepts({concepts:[{uri:c}]}))[0];let h=await a(r);const w=new Set([r]);for(;h;){const c=(F=((A=h.ancestors)==null?void 0:A[0])||((B=h.broader)==null?void 0:B[0]))==null?void 0:F.uri;if(!c||w.has(c))break;w.add(c),u.push({uri:c}),h=await a(c)}u.reverse()}catch{return!1}let s=l.concepts.find(a=>d(a,u[0]));if(!s)return!1;for(let a=1;a<u.length;a++){if(m[s.uri]=!0,(!Array.isArray(s.narrower)||s.narrower.includes(null))&&typeof s._getNarrower=="function")try{s.narrower=W(await s._getNarrower())}catch{}const w=(s.narrower||[]).find(c=>d(c,u[a]));if(!w)return!1;s=w}return t&&g("update:modelValue",s),await q(),V(r,o),!0}return C({isUriInView:O,scrollToUri:V,navigateToUri:R}),(e,t)=>{var o;return y(),N(X,D({ref:"itemList"},p.itemListOptions,{class:{"jskos-vue-conceptTree":!0,"jskos-vue-conceptTree-noHierarchy":!p.hierarchy},items:L.value,"item-property":"concept","highlight-by-uri":(o=p.modelValue)!=null&&o.uri?{[p.modelValue.uri]:!0}:{},onSelect:t[0]||(t[0]=r=>{e.$emit("select",r),e.$emit("update:modelValue",r.item)})}),{beforeItem:b(({item:r})=>[(y(!0),T(Z,null,x(r.depth,i=>(y(),T("div",{key:i,class:"jskos-vue-conceptTree-depthSpacer"}))),128)),p.hierarchy?(y(),T("div",{key:0,class:"jskos-vue-conceptTree-arrow",onClick:z(i=>M(r.concept),["stop"])},[r.concept&&r.concept.narrower&&r.concept.narrower.length!==0?(y(),N(Y,{key:0,direction:m[r.concept.uri]?"down":"right",clickable:!0},null,8,["direction"])):P("",!0)],8,_)):P("",!0),v(e.$slots,"beforeItem",{item:r.concept})]),afterItem:b(({item:r})=>[v(e.$slots,"afterItem",{item:r.concept})]),beforeList:b(()=>[v(e.$slots,"beforeList")]),afterList:b(()=>[v(e.$slots,"afterList")]),_:3},16,["class","items","highlight-by-uri"])}}});export{ne as _};
