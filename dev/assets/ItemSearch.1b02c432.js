import{h as e,A as s,e as t,l,B as a,C as n,D as u,V as o,v as r,x as c,n as i,o as v,c as d,p as m,E as h,G as p,b as g,H as f,k as y,I as k,F as w,q as S,J as b,w as j}from"./app.a5d7b78a.js";import{_ as R}from"./LoadingIndicator.afa78c4a.js";import"./shared.4aef2e40.js";function I(t,l=!1){const a=e=>{for(const s of t()){const t=(s.elements||[]).reduce(((s,t)=>s||t&&t.contains(e.target)),!1);!l&&t||s.handler({event:e,isInside:t})}};e((()=>{document.addEventListener("click",a)})),s((()=>{document.removeEventListener("click",a)}))}function L(e,s,t){var l;return function(){var a=this,n=arguments,u=function(){l=null,t||e.apply(a,n)},o=t&&!l;clearTimeout(l),l=setTimeout(u,s),o&&e.apply(a,n)}}var E=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",dateToString:function(e){let s=new Date(e);if(s instanceof Date&&!isNaN(s)){if(e.length<10)return e;let t={year:"numeric",month:"short",day:"numeric"};return e.length>10&&(t=Object.assign({hour:"2-digit",minute:"2-digit",second:"2-digit"},t)),s.toLocaleString(void 0,t)}return"?"},addClickHandlers:I,debounce:L});function T(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const x=t({name:"ItemSearch",components:{LoadingIndicator:R},props:{scheme:{type:Object,required:!0},registry:{type:Object,default:null}},emits:["select"],setup(e,{emit:s}){const t=l((()=>e.registry||e.scheme._registry)),r=a(!1),c=a(!1),i=a(null),v=a(""),d=a(-1),m=a([]),h=a(!1),p=a(null),g=a(null),f=a(null),y=L((async s=>{if(!t.value)return[];s=s.trim(),m.value=[],r.value=!0;const l=t.value.suggest({search:s,scheme:e.scheme});let a;i.value=l.cancel;try{a=(await l).slice(1).reduce(((e,s)=>e=s.map(((s,t)=>(e[t]||[]).concat(s)))),[])}catch(n){if("canceled"===n.message)return;console.error(n),a=[]}s===v.value.trim()&&(m.value=a,i.value=null,r.value=!1)}),200);n(v,(e=>{d.value=-1,null!=i.value&&(i.value("There was a newer search query."),i.value=null),""===e?(r.value=!1,c.value=!1):(m.value=["Waiting for you to stop typing..."],r.value=!0,c.value=!0,y(e))})),n((()=>e.scheme),((e,s)=>{b.compare(s,e)||(v.value="",m.value=[],c.value=!1,r.value=!1,d.value=-1)}));const k=()=>{c.value=!1},w=t=>{k(),d.value=-1,s("select",{uri:m.value[t][2],inScheme:[e.scheme]}),document.activeElement!==document.body&&document.activeElement.blur()},S=()=>{const e=f.value.childNodes[d.value+1];if(e){const s=e.parentElement.parentElement,t=e.getBoundingClientRect(),l=s.getBoundingClientRect();o.scrollTo(e,100,{container:s,easing:"ease-in",offset:t.bottom>l.bottom?-l.height+t.height:0,cancelable:!0,x:!1,y:!0,force:!1})}};return I((()=>[{elements:[p.value],handler:()=>{c.value=!1,d.value=-1}}])),{isLoading:r,isOpen:c,query:v,searchSelected:d,results:m,uniqueID:"abc",openResults:()=>{c.value=""!==v.value},closeResults:k,chooseResult:w,itemSearch:p,searchInput:g,resultList:f,mouseover(e){h.value||(d.value=e)},mousemove(){h.value=!1},onArrowDown(){h.value=!0,d.value>=m.value.length-1?d.value=0:d.value+=1,S()},onArrowUp(){h.value=!0,d.value<=0?d.value=m.value.length-1:d.value-=1,S()},onEnter(){let e;r.value||0===m.value.length||(e=d.value<0||d.value>=m.value.length?0:d.value,w(e))},highlightQueryInResult:e=>{if(!v.value.length)return e;const s=v.value,t=new RegExp(s,"ig");let l=t.exec(e),a=0,n="";for(;l;){let u=l.index;n+=T(e.slice(a,u))+"<span class='jskos-vue-text-bold'>"+T(e.slice(u,u+s.length))+"</span>",a=u+s.length,l=t.exec(e)}return n+=T(e.slice(a)),n},focus(){g.value.focus()},setQuery(e,s=!1){v.value=e,s?g.value.focus():u((()=>{k()}))}}}}),_=j();r("data-v-04136c46");const q={class:"jskos-vue-itemSearch-results jskos-vue-text-small"},A={key:0,class:"jskos-vue-itemSearch-loading"},D={ref:"resultList",class:"jskos-vue-itemSearch-results-list"},O={key:0,class:"jskos-vue-itemSearch-results-item"},C=g("div",null,"No results",-1);c();const M=_(((e,s,t,l,a,n)=>{const u=i("loading-indicator");return v(),d("div",{ref:"itemSearch",class:"jskos-vue-itemSearch",onMousemove:s[8]||(s[8]=(...s)=>e.mousemove&&e.mousemove(...s))},[m(" Input field "),h(g("input",{ref:"searchInput","onUpdate:modelValue":s[1]||(s[1]=s=>e.query=s),placeholder:"Type to search...",onClick:s[2]||(s[2]=(...s)=>e.openResults&&e.openResults(...s)),onKeydown:[s[3]||(s[3]=f(y(((...s)=>e.onArrowDown&&e.onArrowDown(...s)),["prevent"]),["down"])),s[4]||(s[4]=f(y(((...s)=>e.onArrowUp&&e.onArrowUp(...s)),["prevent"]),["up"]))],onKeyup:[s[5]||(s[5]=f(((...s)=>e.onEnter&&e.onEnter(...s)),["enter"])),s[6]||(s[6]=f((s=>{e.$refs.searchInput.blur(),e.closeResults()}),["esc"]))],onFocus:s[7]||(s[7]=(...s)=>e.openResults&&e.openResults(...s))},null,544),[[p,e.query]]),m(" Results "),h(g("div",q,[m(" Loading indicator if necessary "),e.isLoading?(v(),d("div",A,[g(u,{size:"md"})])):(v(),d(w,{key:1},[m(" If not loading, show results "),g("ul",D,[(v(!0),d(w,null,S(e.results,((s,t)=>(v(),d("li",{key:t,class:[{"jskos-vue-itemSearch-selected":t===e.searchSelected},"jskos-vue-itemSearch-results-item"],onClick:s=>e.chooseResult(t),onMouseover:s=>e.mouseover(t)},[g("span",{innerHTML:e.highlightQueryInResult(s[0])},null,8,["innerHTML"])],42,["onClick","onMouseover"])))),128)),0==e.results.length?(v(),d("li",O,[m(" TODO: Add other languages "),C])):m("v-if",!0)],512)],2112))],512),[[k,e.isOpen]])],544)}));x.render=M,x.__scopeId="data-v-04136c46";export{x as _,E as u};
