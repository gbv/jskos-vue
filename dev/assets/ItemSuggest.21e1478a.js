import{e,s,B as l,C as t,V as u,m as n,o as a,c as o,n as r,z as c,D as i,b as v,E as g,i as m,A as p,F as d,p as h}from"./app.299cedce.js";import{_ as f}from"./LoadingIndicator.55435477.js";import{a as y,b as k}from"./utils.9c5057b1.js";import"./shared.99084317.js";function w(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const R=e({name:"ItemSuggest",components:{LoadingIndicator:f},props:{search:{type:Function,default:null}},emits:["select"],setup(e,{emit:n}){const a=s(!1),o=s(!1),r=s(null),c=s(""),i=s(-1),v=s([]),g=s(!1),m=s(null),p=s(null),d=s(null),h=k((async s=>{s=s.trim(),v.value=[],a.value=!0;const l=e.search(s);let t;r.value=l.cancel;try{t=(await l).slice(1).reduce(((e,s)=>e=s.map(((s,l)=>(e[l]||[]).concat(s)))),[])}catch(u){if("canceled"===u.message)return;console.error(u),t=[]}s===c.value.trim()&&(v.value=t,r.value=null,a.value=!1)}),200);l(c,(e=>{i.value=-1,null!=r.value&&(r.value("There was a newer search query."),r.value=null),""===e?(a.value=!1,o.value=!1):(v.value=["Waiting for you to stop typing..."],a.value=!0,o.value=!0,h(e))}));const f=()=>{o.value=!1},R=e=>{f(),i.value=-1,n("select",{uri:v.value[e][2]}),document.activeElement!==document.body&&document.activeElement.blur()},j=()=>{const e=d.value.childNodes[i.value+1];if(e){const s=e.parentElement.parentElement,l=e.getBoundingClientRect(),t=s.getBoundingClientRect();u.scrollTo(e,100,{container:s,easing:"ease-in",offset:l.bottom>t.bottom?-t.height+l.height:0,cancelable:!0,x:!1,y:!0,force:!1})}};return y((()=>[{elements:[m.value],handler:()=>{o.value=!1,i.value=-1}}])),{isLoading:a,isOpen:o,query:c,searchSelected:i,results:v,uniqueID:"abc",openResults:()=>{o.value=""!==c.value},closeResults:f,chooseResult:R,itemSuggest:m,searchInput:p,resultList:d,mouseover(e){g.value||(i.value=e)},mousemove(){g.value=!1},onArrowDown(){g.value=!0,i.value>=v.value.length-1?i.value=0:i.value+=1,j()},onArrowUp(){g.value=!0,i.value<=0?i.value=v.value.length-1:i.value-=1,j()},onEnter(){let e;a.value||0===v.value.length||(e=i.value<0||i.value>=v.value.length?0:i.value,R(e))},highlightQueryInResult:e=>{if(!c.value.length)return e;const s=c.value,l=new RegExp(s,"ig");let t=l.exec(e),u=0,n="";for(;t;){let a=t.index;n+=w(e.slice(u,a))+"<span class='jskos-vue-text-bold'>"+w(e.slice(a,a+s.length))+"</span>",u=a+s.length,t=l.exec(e)}return n+=w(e.slice(u)),n},focus(){p.value.focus()},setQuery(e,s=!1){c.value=e,s?p.value.focus():t((()=>{f()}))}}}}),j={class:"jskos-vue-itemSuggest-results jskos-vue-text-small"},I={key:0,class:"jskos-vue-itemSuggest-loading"},S={ref:"resultList",class:"jskos-vue-itemSuggest-results-list"},b={key:0,class:"jskos-vue-itemSuggest-results-item"},E=v("div",null,"No results",-1);R.render=function(e,s,l,t,u,f){const y=n("loading-indicator");return a(),o("div",{ref:"itemSuggest",class:"jskos-vue-itemSuggest",onMousemove:s[8]||(s[8]=(...s)=>e.mousemove&&e.mousemove(...s))},[r(" Input field "),c(v("input",{ref:"searchInput","onUpdate:modelValue":s[1]||(s[1]=s=>e.query=s),placeholder:"Type to search...",onClick:s[2]||(s[2]=(...s)=>e.openResults&&e.openResults(...s)),onKeydown:[s[3]||(s[3]=g(m(((...s)=>e.onArrowDown&&e.onArrowDown(...s)),["prevent"]),["down"])),s[4]||(s[4]=g(m(((...s)=>e.onArrowUp&&e.onArrowUp(...s)),["prevent"]),["up"]))],onKeyup:[s[5]||(s[5]=g(((...s)=>e.onEnter&&e.onEnter(...s)),["enter"])),s[6]||(s[6]=g((s=>{e.$refs&&e.$refs.searchInput&&e.$refs.searchInput.blur(),e.closeResults()}),["esc"]))],onFocus:s[7]||(s[7]=(...s)=>e.openResults&&e.openResults(...s))},null,544),[[i,e.query]]),r(" Results "),c(v("div",j,[r(" Loading indicator if necessary "),e.isLoading?(a(),o("div",I,[v(y,{size:"md"})])):(a(),o(d,{key:1},[r(" If not loading, show results "),v("ul",S,[(a(!0),o(d,null,h(e.results,((s,l)=>(a(),o("li",{key:l,class:[{"jskos-vue-itemSuggest-selected":l===e.searchSelected},"jskos-vue-itemSuggest-results-item"],onClick:s=>e.chooseResult(l),onMouseover:s=>e.mouseover(l)},[v("span",{innerHTML:e.highlightQueryInResult(s[0])},null,8,["innerHTML"])],42,["onClick","onMouseover"])))),128)),0==e.results.length?(a(),o("li",b,[r(" TODO: Add other languages "),E])):r("v-if",!0)],512)],2112))],512),[[p,e.isOpen]])],544)};export{R as _};
